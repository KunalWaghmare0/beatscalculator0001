<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TapTempo — BPM Calculator</title>
<style>
  :root{--bg:#fbfdff;--card:#fff;--accent:#0b66ff;--muted:#556;--glass:rgba(11,102,255,0.06)}
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#f2f7ff);color:#07203a;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
  .wrap{width:920px;max-width:100%;display:grid;grid-template-columns:1fr 340px;gap:20px}
  .card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(8,20,40,0.06)}
  h1{margin:0 0 6px;font-size:20px}
  .lead{color:var(--muted);font-size:13px;margin-bottom:14px}
  .bpm-display{font-weight:700;font-size:64px;text-align:center;padding:20px;border-radius:10px;background:linear-gradient(90deg,var(--glass),transparent);margin-bottom:10px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  button{cursor:pointer;padding:10px 14px;border-radius:8px;border:1px solid rgba(7,32,58,0.06);background:#fff;font-weight:600}
  .tap-btn{background:var(--accent);color:#fff;border:none;font-size:18px;padding:14px 20px}
  .small{font-size:13px;color:var(--muted)}
  .meta{font-size:13px;color:var(--muted);margin-top:8px;text-align:center}
  .note{font-size:12px;color:#334;opacity:.8;margin-top:10px}
  footer{grid-column:1/-1;text-align:center;color:var(--muted);font-size:12px;margin-top:12px}
  @media (max-width:880px){.wrap{grid-template-columns:1fr;}}
</style>
</head>
<body>
  <div class="wrap">
    <!-- Left: main -->
    <div class="card">
      <h1>BPM (Beats Per Minute) Calculator</h1>
      <div class="lead">Tap the button with the beat (or press <strong>Space</strong>) to estimate tempo.</div>

      <div class="bpm-display" id="bpmDisplay">—</div>

      <div class="controls">
        <button id="tapBtn" class="tap-btn" title="Tap spacebar">Tap</button>
        <button id="resetBtn">Reset</button>
        <button id="copyBtn">Copy BPM</button>
      </div>

      <div class="meta" id="metaInfo">Taps: 0 · Smoothed BPM: — · Raw BPM: —</div>

      <div style="margin-top:14px">
        <div class="note">Tip: Tap steadily 4–8 times. The display uses smoothing to reduce jumps.</div>
      </div>
    </div>

    <!-- Right: explanation & tips -->
    <div class="card right">
      <h2 style="margin:0 0 8px">How it works</h2>
      <p class="small">Each tap records a timestamp. The app computes the average time between recent taps (Δt), converts that into tempo using BPM = 60 / Δt, and applies smoothing so the value stabilizes quickly.</p>

      <h3 style="margin-top:12px;margin-bottom:6px">Features</h3>
      <ul class="small" style="padding-left:18px">
        <li>Tap-based BPM with smoothing</li>
        <li>Quick reset and copy</li>
        <li>Keyboard support (Space key)</li>
      </ul>

      <h3 style="margin-top:12px;margin-bottom:6px">Usage tips</h3>
      <ol class="small" style="padding-left:18px">
        <li>Tap steadily (4–8 taps) for a stable reading.</li>
        <li>Avoid accidental double-taps; if that happens press Reset and try again.</li>
        <li>Use headphones or a metronome if matching a live performance.</li>
      </ol>

      <div style="margin-top:10px">
        <strong>Deploy:</strong> Host on GitHub Pages or Netlify (static site).<br>
        <span class="small">No backend required.</span>
      </div>
    </div>

    <footer class="card" style="text-align:center">Built with basic timing logic • Suitable for GitHub Pages</footer>
  </div>

<script>
/* ---------- Tap tempo logic (simplified; no timestamps shown) ---------- */
const tapBtn = document.getElementById('tapBtn');
const resetBtn = document.getElementById('resetBtn');
const copyBtn = document.getElementById('copyBtn');
const bpmDisplay = document.getElementById('bpmDisplay');
const metaInfo = document.getElementById('metaInfo');

let taps = [];           // timestamps in seconds
let smoothedBPM = null;
let lastRawBPM = null;
const SMOOTH_ALPHA = 0.25; // exponential smoothing amount (0-1)

function updateUI() {
  bpmDisplay.textContent = smoothedBPM ? Math.round(smoothedBPM) : '—';
  metaInfo.textContent = `Taps: ${taps.length} · Smoothed BPM: ${smoothedBPM?Math.round(smoothedBPM):'—'} · Raw BPM: ${lastRawBPM?Math.round(lastRawBPM):'—'}`;
}

function addTap(ts) {
  taps.push(ts);
  // keep reasonable history
  if(taps.length>100) taps = taps.slice(-100);
  if(taps.length>=2) {
    // compute average interval between first and last of recent window (last N taps)
    const N = Math.min(6, taps.length);
    const recent = taps.slice(-N);
    const avgInterval = (recent[recent.length-1] - recent[0]) / (recent.length - 1);
    const rawBPM = 60 / avgInterval;
    lastRawBPM = rawBPM;
    // exponential smoothing to stabilize
    if(smoothedBPM == null) smoothedBPM = rawBPM;
    else smoothedBPM = (SMOOTH_ALPHA * rawBPM) + ((1 - SMOOTH_ALPHA) * smoothedBPM);
  }
  updateUI();
}

tapBtn.addEventListener('click', () => addTap(performance.now()/1000));
resetBtn.addEventListener('click', () => { taps=[]; smoothedBPM=null; lastRawBPM=null; updateUI(); });

copyBtn.addEventListener('click', async () => {
  if(!smoothedBPM) return alert('No BPM to copy');
  try { await navigator.clipboard.writeText(Math.round(smoothedBPM).toString()); alert('BPM copied'); } catch(e){ alert('Copy failed'); }
});

window.addEventListener('keydown', (e)=> { if(e.code === 'Space') { e.preventDefault(); addTap(performance.now()/1000); } });

/* init UI */
updateUI();
</script>
</body>
</html>
